# 手游前端架构——姜鹏
#分享会/欢乐互娱#

## 为甚做架构
框架需要关心的要素
* 性能
* 扩展性
* 开发效率

## 架构包含的内容
## 架构关键点
接口简单，将复杂度隐藏

## 语言
### C++
文件系统
热更新
lua 
pb
recast
数学库
…

### C#
AB管理
线程任务调度
lua导出

## 性能
卡顿问题
以往分帧和预加载，但是实际上各自有问题

实际上最好是将Action进行异步化：线程或者协程
线程可以高效利用CPU计算能力。
如果要使用Unity相关类需要用协程，这个时候要用到任务队列进行调度（设置超时控制，每帧有时间限制以及任务数量限制）
类似于网络消息也可以用相同的方式进行解决。

## 大场景动态加载
制作更大规模场景，提高场景加载的速度
轻微加大加载压力
牺牲美术效果 一点点显示

不好的方法：所有动态加载物件信息放在表里面，每次去找位置，CPU压力大
更好的方式：基于四叉树，美术设置好场景根节点，递归分四块产出树与叶子节点。动态物体信息放入四叉树中进行管理。利用相较测试，根据距离更新，实时维护加载列表

物体分级

## 加密
定义自己的文件头

## Lua扩展
妖尾项目中的上层游戏逻辑全部是使用lua

数据层：分离逻辑和数据，用于单元测试和单机环境
UI层：封装底层，上层仅交互逻辑
组件层：监听网络消息，监听内部消息

## 开发效率
### Lua
热更新
便于调试

### 编辑器
数据问题


## ECS

